# tox.ini - UV-compatible configuration
#
# This tox configuration uses UV as the backend for maximum performance.
# All commands delegate to the Makefile which uses UV directly.
#
# Migration Note: This maintains backward compatibility with tox commands
# while leveraging UV's performance benefits. You can use either:
#   - tox -e lint     (backward compatible)
#   - make lint       (direct UV, faster)
#
# For more details, see: docs/tox-to-uv-migration.md

[tox]
min_version = 4.0
# Skip package installation - UV handles this via Makefile
skipsdist = true
# Define available environments
envlist =
    lint
    type
    test
    coverage
    format
    format-check

[testenv]
# Allow external commands (make, uv)
allowlist_externals =
    make
    uv
# Use UV to sync dependencies before running commands
# This ensures the virtual environment has all required packages
commands_pre =
    uv sync --extra dev
# Set environment variables for consistent behavior
setenv =
    PYTHONPATH = {toxinidir}
    UV_PROJECT_ENVIRONMENT = {envdir}

[testenv:lint]
description = Run linting (flake8 + pylint)
commands =
    make lint

[testenv:type]
description = Run type checking with mypy
commands =
    make type

[testenv:test]
description = Run tests with pytest
commands =
    make test

[testenv:coverage]
description = Run tests with coverage report
commands =
    make coverage

[testenv:format]
description = Format code with black
commands =
    make format

[testenv:format-check]
description = Check code formatting without modifying
commands =
    make format-check

[testenv:clean]
description = Clean generated files and caches
allowlist_externals =
    make
    rm
    find
skip_install = true
commands =
    make clean

[testenv:docs]
description = Build documentation with mkdocs
commands_pre =
    uv sync --extra doc
commands =
    make docs-build

[testenv:docs-serve]
description = Serve documentation locally
commands_pre =
    uv sync --extra doc
commands =
    make docs-serve

# Convenience environment to run all checks
[testenv:all]
description = Run all checks (lint, type, test)
commands =
    make check

# CI-specific environment optimized for GitHub Actions
[testenv:ci]
description = Run all CI checks (optimized for CI environment)
commands_pre =
    uv sync --frozen --extra dev
commands =
    make ci-all

# GitHub Actions matrix configuration
[gh-actions]
python =
    3.9: test
    3.10: test
    3.11: test
    3.12: test, lint, type, coverage
    3.13: test, lint, type, coverage
